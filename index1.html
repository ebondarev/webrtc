<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Peer</title>
  <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
</head>

<body>
  <div id="peer-id">Id: </div>
  <div>
    <input type="text" placeholder="input id" id="input-id"></input>
    <button id="btn-connect">Connect</button>
  </div>
  <video id="player"></video>
  <div id="log-infov"></div>
  <div id="log-error">Errors:</div>

  <script>
    var callOptions = {
      'iceServers': [
        { url: 'stun:stun01.sipphone.com' },
        { url: 'stun:stun.ekiga.net' },
        { url: 'stun:stun.fwdnet.net' },
        { url: 'stun:stun.ideasip.com' },
        { url: 'stun:stun.iptel.org' },
        { url: 'stun:stun.rixtelecom.se' },
        { url: 'stun:stun.schlund.de' },
        { url: 'stun:stun.l.google.com:19302' },
        { url: 'stun:stun1.l.google.com:19302' },
        { url: 'stun:stun2.l.google.com:19302' },
        { url: 'stun:stun3.l.google.com:19302' },
        { url: 'stun:stun4.l.google.com:19302' },
        { url: 'stun:stunserver.org' },
        { url: 'stun:stun.softjoys.com' },
        { url: 'stun:stun.voiparound.com' },
        { url: 'stun:stun.voipbuster.com' },
        { url: 'stun:stun.voipstunt.com' },
        { url: 'stun:stun.voxgratia.org' },
        { url: 'stun:stun.xten.com' },
        {
          url: 'turn:numb.viagenie.ca',
          credential: 'muazkh',
          username: 'webrtc@live.com'
        },
        {
          url: 'turn:192.158.29.39:3478?transport=udp',
          credential: 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',
          username: '28224511:1379330808'
        },
        {
          url: 'turn:192.158.29.39:3478?transport=tcp',
          credential: 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',
          username: '28224511:1379330808'
        }
      ]
    };

    var peer = new Peer({ config: callOptions });
    var peerId;
    peer.on('open', function (_peerId) {
      peerId = _peerId
      document.getElementById('peer-id').innerHTML += _peerId;

      peer.on('call', function(call) {
        navigator.mediaDevices.getUserMedia ({ audio: true, video: true })
          .then(function (mediaStream) {
            call.answer(mediaStream);
          })
          .catch(function (err) {
            document.getElementById('log-error').innerHTML += "\n" + err.name + ": " + err.message;
          });
      });
    });

    // Server call
    document.getElementById('btn-connect').addEventListener('click', function sendStreem() {
      if (peerId === undefined) {
        document.getElementById('log-error').innerHTML += "\npeerId is undefined";
      }
      var call = peer.call(peerId);
      document.getElementById('log-info').innerHTML += "\ncalling...";
      call.on('stream', function(mediaStream) {
        document.getElementById('player').srcObject = mediaStream;
      });

    });

  </script>
</body>
</html>
